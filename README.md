CaliPy - Camera Calibration Application
=======================================

CaliPy is a Qt-based calibration application written in Python. It displays results generated by bbo(lab)-calibcam in the background to check camera calibration.

Currently supported calibration patterns:

  - [ChAruco Boards](https://docs.opencv.org/3.4.6/da/d13/tutorial_aruco_calibration.html)

Currently supported camera models:

  - [Pinhole Camera Model](https://docs.opencv.org/3.4.6/d9/d0c/group__calib3d.html#details)
  - [Omnidirectional Camera Model](https://docs.opencv.org/3.4.6/d3/ddc/group__ccalib.html)

Installation
------------

CaliPy depends on the following Python packages:

  - NumPy
  - PyYAML
  - OpenCV
  - ImageIO with FFMPEG support
  - Construct
  - PyQt5
  - PyQtGraph
  - Bbolab/Calibcam
  - Bbolab/Calibcamlib
  - Bbolab/svidreader
  - PyInstaller (optional, for standalone build)

Current best practise is to use conda env.
#### Conda

You can install all the required dependencies into a conda environment with the following command:

    conda env create -f environment.yml

Then run the cali.py script with `python cali.py` from the newly created environment.

Alterntively if you have the ```pyinstaller``` package installed (i.e. via pip) you can turn CaliPy into a self-contained executable with the following command:

    python3 setup.py standalone

The resulting ```CaliPy``` folder inside the ```dist``` subfolder can then be packed and distributed without the need to install any dependencies.



Usage
-----
1. This is a GUI to view bbo-lab calibcam results. The software offers some commandline options:
   1. `--system_file` is for loading any calipy session files containing source info and video paths.
   2. `--videos` and `--pipelines` can be alternatively used to provide paths to video files, and any pipelines to be
      applied on these videos. The final output of the pipeline is used to display calibration.
   3. `--calib_file` is for loading calibraiton results from _bbo-calibcam_. If no video information is provided using the above
      commandline options, the software will attempt to load videos from the calib_file. Then, the video links in the
      calib_file should be active.

   _Note: if no proper commandline options are provided, an empty GUI is loaded._


2. Add cameras with appropriate identifiers in the 'Cameras' dock on the top left side of the window.
3. In the 'Sources' dock, add a session and add a recording for each one of the cameras to the session. Multiple such sessions can be added.
4. This is a GUI to view bbo-lab calibcam results. On the _Menubar_, use `Result > Load .npy` to load calibcam calibration files.
5. Ideally, the software should match the already loaded videos to the 'rec_file_names' in the calibcam dictionary.


Format
------

Use ```File > Save..``` to save the session and the added sources as a ```.system.yml``` file. The session can be reopened by selecting it under ```File > Open..```.

Bbo-calibcam files are either ```.yml``` or ```.npy``` files containing a dictionary. Use ```Result > Load Calib``` to load them.
